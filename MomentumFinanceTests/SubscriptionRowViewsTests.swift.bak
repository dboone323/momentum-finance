@testable import MomentumFinance
import XCTest

class SubscriptionRowViewsTests: XCTestCase {
    var viewModel: Features.Subscriptions.EnhancedSubscriptionRowViewModel!

    override func setUp() {
        super.setUp()
        viewModel = Features.Subscriptions.EnhancedSubscriptionRowViewModel(subscription: Features.Subscriptions.Subscription(name: "Monthly Subscription", amount: 10.99, billingCycle: .monthly))
    }

    override func tearDown() {
        viewModel = nil
        super.tearDown()
    }

    // Test the EnhancedSubscriptionRowView with a valid subscription
    func testEnhancedSubscriptionRowViewWithValidSubscription() {
        // GIVEN
        let expectedName = "Monthly Subscription"
        let expectedAmountText = "$10.99 / Monthly"
        let expectedStatusText = "Active"
        let expectedDaysUntilDue = 7

        // WHEN
        let result = viewModel.body

        // THEN
        XCTAssertEqual(result.name, expectedName)
        XCTAssertEqual(result.amountText, expectedAmountText)
        XCTAssertEqual(result.statusText, expectedStatusText)
        XCTAssertEqual(result.daysUntilDue, expectedDaysUntilDue)
    }

    // Test the EnhancedSubscriptionRowView with an inactive subscription
    func testEnhancedSubscriptionRowViewWithInactiveSubscription() {
        // GIVEN
        let subscription = Features.Subscriptions.Subscription(name: "Monthly Subscription", amount: 10.99, billingCycle: .monthly, isActive: false)
        viewModel = Features.Subscriptions.EnhancedSubscriptionRowViewModel(subscription: subscription)

        // WHEN
        let result = viewModel.body

        // THEN
        XCTAssertEqual(result.name, subscription.name)
        XCTAssertEqual(result.amountText, "$10.99 / Monthly")
        XCTAssertEqual(result.statusText, "Inactive")
    }

    // Test the EnhancedSubscriptionRowView with a subscription due soon
    func testEnhancedSubscriptionRowViewWithSubscriptionDueSoon() {
        // GIVEN
        let subscription = Features.Subscriptions.Subscription(name: "Monthly Subscription", amount: 10.99, billingCycle: .monthly, nextDueDate: Date().addingTimeInterval(7 * 24 * 60 * 60))
        viewModel = Features.Subscriptions.EnhancedSubscriptionRowViewModel(subscription: subscription)

        // WHEN
        let result = viewModel.body

        // THEN
        XCTAssertEqual(result.name, subscription.name)
        XCTAssertEqual(result.amountText, "$10.99 / Monthly")
        XCTAssertEqual(result.statusText, "Due Soon")
    }

    // Test the EnhancedSubscriptionRowView with a subscription overdue
    func testEnhancedSubscriptionRowViewWithSubscriptionOverdue() {
        // GIVEN
        let subscription = Features.Subscriptions.Subscription(name: "Monthly Subscription", amount: 10.99, billingCycle: .monthly, nextDueDate: Date().addingTimeInterval(8 * 24 * 60 * 60))
        viewModel = Features.Subscriptions.EnhancedSubscriptionRowViewModel(subscription: subscription)

        // WHEN
        let result = viewModel.body

        // THEN
        XCTAssertEqual(result.name, subscription.name)
        XCTAssertEqual(result.amountText, "$10.99 / Monthly")
        XCTAssertEqual(result.statusText, "Overdue")
    }
}
