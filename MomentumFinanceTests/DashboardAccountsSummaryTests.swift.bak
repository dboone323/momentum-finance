@testable import MomentumFinance
import XCTest

class DashboardAccountsSummaryTests: XCTestCase {
    var viewModel: DashboardAccountsSummaryViewModel!
    var accounts: [FinancialAccount]!

    override func setUp() {
        super.setUp()

        // Create some sample data for testing
        let account1 = FinancialAccount(id: UUID(), name: "Checking", balance: 1000.50, iconName: "account")
        let account2 = FinancialAccount(id: UUID(), name: "Savings", balance: 500.75, iconName: "bank")
        let account3 = FinancialAccount(id: UUID(), name: "Investments", balance: 1500.25, iconName: "money")

        accounts = [account1, account2, account3]

        // Initialize the view model with the sample data
        viewModel = DashboardAccountsSummaryViewModel(accounts: accounts)
    }

    override func tearDown() {
        super.tearDown()
        // Clean up any resources here if needed
    }

    // Test that the total balance is calculated correctly
    func testTotalBalance() {
        let expectedTotal = Decimal(3001.50) // 1000.50 + 500.75 + 1500.25
        XCTAssertEqual(viewModel.totalBalance, expectedTotal)
    }

    // Test that the currency display is formatted correctly
    func testCurrencyDisplay() {
        let amount = Decimal(3001.50)
        let expectedFormattedAmount = "$3,001.50"
        XCTAssertEqual(viewModel.currencyDisplay(amount: amount), expectedFormattedAmount)
    }

    // Test that the account details are displayed correctly
    func testAccountDetails() {
        let account = accounts.first!
        let expectedName = "Checking"
        let expectedIconName = "account"
        let expectedBalance = "$1,000.50"

        XCTAssertEqual(viewModel.account.name, expectedName)
        XCTAssertEqual(viewModel.account.iconName, expectedIconName)
        XCTAssertEqual(viewModel.account.balance, expectedBalance)
    }

    // Test that the account details are displayed correctly with multiple accounts
    func testMultipleAccounts() {
        let expectedNames = ["Checking", "Savings", "Investments"]
        let expectedIconNames = ["account", "bank", "money"]

        for i in 0 ..< 3 {
            XCTAssertEqual(viewModel.accounts[i].name, expectedNames[i])
            XCTAssertEqual(viewModel.accounts[i].iconName, expectedIconNames[i])
        }
    }

    // Test that the account details are displayed correctly with more than three accounts
    func testMoreThanThreeAccounts() {
        let expectedNames = ["Checking", "Savings", "Investments", "Other"]
        let expectedIconNames = ["account", "bank", "money", "other"]

        for i in 0 ..< 4 {
            XCTAssertEqual(viewModel.accounts[i].name, expectedNames[i])
            XCTAssertEqual(viewModel.accounts[i].iconName, expectedIconNames[i])
        }
    }

    // Test that the account details are displayed correctly with a single account
    func testSingleAccount() {
        let expectedName = "Checking"
        let expectedIconName = "account"
        let expectedBalance = "$1,000.50"

        XCTAssertEqual(viewModel.accounts.first!.name, expectedName)
        XCTAssertEqual(viewModel.accounts.first!.iconName, expectedIconName)
        XCTAssertEqual(viewModel.accounts.first!.balance, expectedBalance)
    }

    // Test that the account details are displayed correctly with no accounts
    func testNoAccounts() {
        let viewModel = DashboardAccountsSummaryViewModel(accounts: [])

        XCTAssertTrue(viewModel.accounts.isEmpty)
    }
}
